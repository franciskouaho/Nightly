rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Règles pour les avatars utilisateur
    match /avatars/{userId}/{fileName} {
      allow read: if true; // Lecture publique des avatars
      allow write: if request.auth != null && request.auth.uid == userId;
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles pour les images de profil
    match /profiles/{userId}/{fileName} {
      allow read: if true; // Lecture publique des profils
      allow write: if request.auth != null && request.auth.uid == userId;
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles pour les assets/skins du jeu
    match /gameAssets/{assetId}/{fileName} {
      allow read: if true; // Lecture publique des assets
      allow write: if false; // Seuls les admins peuvent uploader
      allow delete: if false; // Seuls les admins peuvent supprimer
    }
    
    // Règles pour les images de jeux
    match /gameImages/{gameId}/{fileName} {
      allow read: if true; // Lecture publique des images de jeux
      allow write: if false; // Seuls les admins peuvent uploader
      allow delete: if false; // Seuls les admins peuvent supprimer
    }
    
    // Règles pour les images d'événements
    match /events/{eventId}/{fileName} {
      allow read: if true; // Lecture publique des images d'événements
      allow write: if false; // Seuls les admins peuvent uploader
      allow delete: if false; // Seuls les admins peuvent supprimer
    }
    
    // Règles pour les captures d'écran de jeu
    match /screenshots/{userId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles pour les fichiers de debug/logs
    match /debug/{userId}/{fileName} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles pour les fichiers temporaires
    match /temp/{userId}/{fileName} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles pour les fichiers de sauvegarde
    match /backups/{userId}/{fileName} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles pour les fichiers de configuration
    match /config/{fileName} {
      allow read: if true; // Lecture publique de la config
      allow write, delete: if false; // Seuls les admins peuvent modifier
    }
    
    // Règles pour les fichiers de traduction
    match /translations/{language}/{fileName} {
      allow read: if true; // Lecture publique des traductions
      allow write, delete: if false; // Seuls les admins peuvent modifier
    }
    
    // Règles pour les fichiers de notification
    match /notifications/{userId}/{fileName} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Règles par défaut - refuser tout le reste
    match /{allPaths=**} {
      allow read, write, delete: if false;
    }
  }
}
